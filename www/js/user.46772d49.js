webpackJsonp([19],{"3GEF":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r("aGHM"),a=r.n(s);for(var o in s)["default","default"].indexOf(o)<0&&function(e){r.d(t,e,function(){return s[e]})}(o);var i=r("Bfa3"),l=r("VU/8"),n=l(a.a,i.a,!1,null,null,null);t.default=n.exports},Bfa3:function(e,t,r){"use strict";var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("FormDlg",{ref:"dlg",attrs:{title:e.$t("m.user_edit"),disabled:e.errors.any()},on:{hide:e.onHide,submit:e.onSubmit}},[e.form.id?e._e():r("div",{staticClass:"alert alert-success alert-dismissible"},[r("small",[e._v(e._s(e.$t("m.user_add_msg"))+" "+e._s(e.defaultPwd))]),e._v(" "),r("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"alert","aria-label":"Close"}},[r("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])]),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.form.id,expression:"form.id",modifiers:{trim:!0}}],attrs:{type:"hidden",name:"id"},domProps:{value:e.form.id},on:{input:function(t){t.target.composing||e.$set(e.form,"id",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),r("div",{class:["form-group",{"has-error":e.errors.has("name")}]},[r("label",{staticClass:"col-sm-3 control-label",attrs:{for:"input-name"}},[r("span",{staticClass:"text-red"},[e._v("*")]),e._v(" "+e._s(e.$t("m.c_username")))]),e._v(" "),r("div",{staticClass:"col-sm-7"},[r("input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"},{name:"model",rawName:"v-model.trim",value:e.form.name,expression:"form.name",modifiers:{trim:!0}}],staticClass:"form-control",attrs:{type:"text",id:"input-name",name:"name","data-vv-as":e.$t("m.c_username")},domProps:{value:e.form.name},on:{keydown:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;t.preventDefault(),e.$el.querySelector("[name=roles]").focus()},input:function(t){t.target.composing||e.$set(e.form,"name",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),r("span",{staticClass:"help-block"},[e._v(e._s(e.errors.first("name")))])])]),e._v(" "),r("div",{class:["form-group",{"has-error":e.errors.has("password")}]},[r("label",{staticClass:"col-sm-3 control-label",attrs:{for:"input-password"}},[e._v(e._s(e.$t("m.user_password")))]),e._v(" "),r("div",{staticClass:"col-sm-7"},[r("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.form.password,expression:"form.password",modifiers:{trim:!0}}],staticClass:"form-control",attrs:{type:"text",id:"input-password",placeholder:e.$t("m.user_not_edit"),name:"password","data-vv-as":e.$t("m.user_password")},domProps:{value:e.form.password},on:{input:function(t){t.target.composing||e.$set(e.form,"password",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),r("span",{staticClass:"help-block"},[e._v(e._s(e.errors.first("password")))])])]),e._v(" "),r("div",{staticClass:"form-group"},[r("label",{staticClass:"col-sm-3 control-label",attrs:{for:"input-roles"}},[r("span",{staticClass:"text-red"},[e._v("*")]),e._v(" "+e._s(e.$t("m.role")))]),e._v(" "),r("div",{staticClass:"col-sm-7"},[r("el-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:e.$t("m.c_select"),name:"roles","data-vv-as":e.$t("m.role")},on:{change:e.changeUserRole},model:{value:e.form.roles,callback:function(t){e.$set(e.form,"roles",t)},expression:"form.roles"}},e._l(e.roles,function(t){return r("el-option",{key:t,attrs:{label:e.$t("m.role_"+t),value:t}})}),1)],1)]),e._v(" "),3!=this.serverInfo.ProductType?r("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"form-group",attrs:{id:"group-vod"}},[r("label",{staticClass:"col-sm-3 control-label",attrs:{for:"input-vods"}},[e._v(e._s(e.$t("m.user_power_vod")))]),e._v(" "),r("div",{staticClass:"col-sm-7"},[r("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"",placeholder:e.$t("m.c_select")},model:{value:e.form.vods,callback:function(t){e.$set(e.form,"vods",t)},expression:"form.vods"}},e._l(e.vods,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)]):e._e(),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"form-group",attrs:{id:"group-live"}},[r("label",{staticClass:"col-sm-3 control-label",attrs:{for:"input-lives"}},[e._v(e._s(e.$t("m.user_power_live")))]),e._v(" "),r("div",{staticClass:"col-sm-7"},[r("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"",placeholder:e.$t("m.c_select")},model:{value:e.form.lives,callback:function(t){e.$set(e.form,"lives",t)},expression:"form.lives"}},e._l(e.lives,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"form-group",attrs:{id:"group-vlive"}},[r("label",{staticClass:"col-sm-3 control-label",attrs:{for:"input-vlives"}},[e._v(e._s(e.$t("m.user_power_vlive")))]),e._v(" "),r("div",{staticClass:"col-sm-7"},[r("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"",placeholder:e.$t("m.c_select")},model:{value:e.form.vlives,callback:function(t){e.$set(e.form,"vlives",t)},expression:"form.vlives"}},e._l(e.vlives,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"form-group",attrs:{id:"group-record"}},[r("label",{staticClass:"col-sm-3 control-label",attrs:{for:"input-records"}},[e._v(e._s(e.$t("m.user_power_playback")))]),e._v(" "),r("div",{staticClass:"col-sm-7"},[r("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"",placeholder:e.$t("m.c_select")},model:{value:e.form.records,callback:function(t){e.$set(e.form,"records",t)},expression:"form.records"}},e._l(e.records,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)])])},a=[],o={render:s,staticRenderFns:a};t.a=o},LNfB:function(e,t,r){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},o=r("3GEF"),i=s(o),l=r("0iPh"),n=s(l),u=r("NYxO");t.default={props:{page:{type:Number,default:1},q:{type:String,default:""}},data:function(){return{query:"",sort:"name",order:"ascending",defaultPwd:"",pageSize:10,total:0,users:[]}},activated:function(){this.$refs.search.focus()},components:{UserFormDlg:i.default},mounted:function(){var e=this;this.query=this.q,this.$refs.search.focus(),this.load(),n.default.get("api/v1/user/defaultPwd").then(function(t){e.defaultPwd=t.msg})},computed:a({},(0,u.mapState)(["userInfo"])),methods:{formatRoles:function(e,t,r){var s=[],a=!0,o=!1,i=void 0;try{for(var l,n=e.roles[Symbol.iterator]();!(a=(l=n.next()).done);a=!0){var u=l.value;s.push(this.$t("m.role_"+u))}}catch(e){o=!0,i=e}finally{try{!a&&n.return&&n.return()}finally{if(o)throw i}}return s.join(", ")},load:function(){var e=this;n.default.post("api/v1/user/list",{q:this.q,start:(this.page-1)*this.pageSize,limit:this.pageSize,sort:this.sort,order:this.order}).then(function(t){var r=t.data;e.total=r.total,e.users=r.rows})},remove:function(e){var t=this;this.$confirm(this.$t("m.c_delete_ensure")+" "+e.name+" ?",this.$t("m.c_prompt")).then(function(){n.default.post("api/v1/user/remove",{id:e.id}).always(function(){t.load()})}).catch(function(){})},resetPwd:function(e){var t=this;this.$confirm(this.$t("m.user_reset_password_msgs")+" "+e.name+" "+this.$t("m.user_reset_password_msge")+" "+this.defaultPwd+" ?",this.$t("m.c_prompt")).then(function(){n.default.post("api/v1/user/resetPwd",{id:e.id}).then(function(e){e.data;t.$message({type:"success",message:t.$t("m.user_reset_password_msg")})})}).catch(function(){})},pageChange:function(e){this.$router.push("/users/"+e+(this.q?"?q="+this.q:""))},sortChange:function(e){this.sort=e.prop,this.order=e.order,this.load()},doSearch:function(){this.page=1,this.$router.push("/users/"+this.page+(this.query?"?q="+this.query:""))}},beforeRouteEnter:function(e,t,r){return e.params.page?(e.params.page=parseInt(e.params.page)||1,e.params.q=e.query.q,r()):r({path:"/users/1",replace:!0})},beforeRouteUpdate:function(e,t,r){var s=this;if(!e.params.page)return r({path:"/users/1",replace:!0});e.params.page=parseInt(e.params.page)||1,e.params.q=e.query.q,r(),this.$nextTick(function(){s.query=s.q,s.load()})}}},aGHM:function(e,t,r){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function s(a,o){try{var i=t[a](o),l=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(l).then(function(e){s("next",e)},function(e){s("throw",e)});e(l)}return s("next")})}}Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},i=r("I3G/"),l=(s(i),r("A9K1")),n=s(l),u=r("0iPh"),c=s(u),d=r("NYxO");t.default={computed:o({},(0,d.mapState)(["serverInfo","userInfo"])),data:function(){return{roles:[],vods:[],lives:[],vlives:[],records:[],password:"",defaultPwd:"",form:this.defForm()}},components:{FormDlg:n.default},mounted:function(){var e=this;c.default.get("api/v1/roles").then(function(t){var r=t.data;e.roles=r}),c.default.get("api/v1/vods").then(function(t){var r=t.data;e.vods=r}),c.default.get("api/v1/lives").then(function(t){var r=t.data;e.lives=r}),c.default.get("api/v1/vlives").then(function(t){var r=t.data;e.vlives=r}),c.default.get("api/v1/records").then(function(t){var r=t.data;e.records=r}),c.default.get("api/v1/user/defaultPwd").then(function(t){e.defaultPwd=t.msg})},methods:{defForm:function(){return{id:"",name:"",password:"",roles:[],vods:[],lives:[],vlives:[],records:[]}},onHide:function(){this.errors.clear(),this.form=this.defForm()},onSubmit:function(){var e=this;return a(regeneratorRuntime.mark(function t(){var r,s,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$validator.validateAll();case 2:if(r=t.sent){t.next=8;break}return s=e.errors.items[0],e.$message({type:"error",message:s.msg}),document.querySelector("[name="+s.field+"]").focus(),t.abrupt("return");case 8:e.form.vods=0==e.form.vods.length?"":e.form.vods,e.form.lives=0==e.form.lives.length?"":e.form.lives,e.form.vlives=0==e.form.vlives.length?"":e.form.vlives,e.form.records=0==e.form.records.length?"":e.form.records,a={},a.id=e.form.id,a.name=e.form.name,a.roles=e.form.roles,a.password=e.form.password,a.vods=e.form.vods,a.lives=e.form.lives,a.records=e.form.records,a.vlives=e.form.vlives,c.default.post("api/v1/user/save",a).then(function(t){t.data;e.form.id==e.userInfo.id&&e.userInfo.name!=e.form.name&&(e.$message({type:"success",message:"用户名已修改，将退出重新登录"}),setTimeout(function(){this.location.replace("/logout")},2e3)),e.$refs.dlg.hide(),e.$emit("submit")});case 22:case"end":return t.stop()}},t,e)}))()},changeUserRole:function(){"general"==this.form.roles?((0,c.default)("#group-vod").show(),(0,c.default)("#group-live").show(),(0,c.default)("#group-vlive").show(),(0,c.default)("#group-record").show()):((0,c.default)("#group-vod").hide(),(0,c.default)("#group-live").hide(),(0,c.default)("#group-vlive").hide(),(0,c.default)("#group-record").hide())},show:function(e){this.errors.clear(),e&&Object.assign(this.form,e),"general"==this.form.roles?((0,c.default)("#group-vod").show(),(0,c.default)("#group-live").show(),(0,c.default)("#group-vlive").show(),(0,c.default)("#group-record").show()):((0,c.default)("#group-vod").hide(),(0,c.default)("#group-live").hide(),(0,c.default)("#group-vlive").hide(),(0,c.default)("#group-record").hide()),this.$refs.dlg.show()}}}},m5jp:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r("LNfB"),a=r.n(s);for(var o in s)["default","default"].indexOf(o)<0&&function(e){r.d(t,e,function(){return s[e]})}(o);var i=r("xU/U"),l=r("VU/8"),n=l(a.a,i.a,!1,null,null,null);t.default=n.exports},"xU/U":function(e,t,r){"use strict";var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"qcontent-header"},[e._v("用户管理 ")]),e._v(" "),r("div",{staticClass:"container-fluid"},[r("div",{staticClass:"box box-success"},[r("div",{staticClass:"box-header"},[r("h4",{staticClass:"text-success text-center"},[e._v(e._s(e.$t("m.user_list")))]),e._v(" "),r("div",{staticClass:"form-inline"},[r("div",{staticClass:"form-group"},[r("button",{staticClass:"btn btn-sm btn-success",attrs:{type:"button"},on:{click:function(t){return t.preventDefault(),e.$refs.userDlg.show()}}},[r("i",{staticClass:"fa fa-plus"}),e._v(" "+e._s(e.$t("m.user_add")))])]),e._v(" "),r("div",{staticClass:"form-group pull-right"},[r("div",{staticClass:"input-group"},[r("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.query,expression:"query",modifiers:{trim:!0}}],ref:"search",staticClass:"form-control",attrs:{type:"text",placeholder:e.$t("m.c_search")},domProps:{value:e.query},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSearch(t)},input:function(t){t.target.composing||(e.query=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),r("div",{staticClass:"input-group-btn"},[r("button",{staticClass:"btn btn-default",attrs:{type:"button"},on:{click:function(t){return t.preventDefault(),e.doSearch(t)}}},[r("i",{staticClass:"fa fa-search"})])])])])])]),e._v(" "),r("div",{staticClass:"box-body"},[r("el-table",{attrs:{data:e.users,stripe:"","default-sort":{prop:"name",order:"ascending"}},on:{"sort-change":e.sortChange}},[r("el-table-column",{attrs:{"min-width":"120",label:"ID",prop:"id"}}),e._v(" "),r("el-table-column",{attrs:{"min-width":"120",label:"登录"+e.$t("m.c_username"),prop:"name","show-overflow-tooltip":"",sortable:"custom"}}),e._v(" "),r("el-table-column",{attrs:{"min-width":"120",label:e.$t("m.role"),prop:"roleNames",formatter:e.formatRoles}}),e._v(" "),r("el-table-column",{attrs:{width:"230",label:e.$t("m.c_operate"),fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticClass:"btn-group"},[r("a",{staticClass:"btn btn-success btn-xs",attrs:{role:"button"},on:{click:function(r){return r.preventDefault(),e.$refs.userDlg.show(t.row)}}},[r("i",{staticClass:"fa fa-edit"}),e._v(" "+e._s(e.$t("m.c_edit")))]),e._v(" "),r("a",{staticClass:"btn btn-warning btn-xs",attrs:{role:"button"},on:{click:function(r){return r.preventDefault(),e.resetPwd(t.row)}}},[r("i",{staticClass:"fa fa-key"}),e._v(" "+e._s(e.$t("m.user_reset_password")))]),e._v(" "),r("a",{directives:[{name:"show",rawName:"v-show",value:t.row.id!=e.userInfo.id,expression:"scope.row.id != userInfo.id "}],staticClass:"btn btn-danger btn-xs",attrs:{role:"button"},on:{click:function(r){return r.preventDefault(),e.remove(t.row)}}},[r("i",{staticClass:"fa fa-remove"}),e._v(" "+e._s(e.$t("m.c_delete")))])])]}}])})],1)],1),e._v(" "),r("div",{staticClass:"box-footer clearfix"},[r("el-pagination",{staticClass:"pull-right",attrs:{layout:"prev,pager,next,jumper",total:e.total,"page-size":e.pageSize,"current-page":e.page},on:{"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"current-change":e.pageChange}})],1),e._v(" "),r("UserFormDlg",{ref:"userDlg",on:{submit:e.load}})],1)])])},a=[],o={render:s,staticRenderFns:a};t.a=o}});